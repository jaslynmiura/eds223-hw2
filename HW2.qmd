---
title: "Homework 2: Exploring patterns of environmental justice"
author: "Jaslyn Miura"
format: html
execute:
  warning: false
  message: false
  cache: true
---

```{r, echo=FALSE}

# loading the required packages
library(tidyverse)
library(sf)
library(here)
library(gt)
library(patchwork)
library(tmap)


```

```{r}

# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- st_read(here::here("data", "ejscreen", "EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))

# read in HOLC Redlining data
redlining <- st_read(here::here("data", "mapping-inequality", "mapping-inequality-los-angeles.json"))

# read in Biodiversity observation data
birds <- st_read(here::here("data", "gbif-birds-LA", "gbif-birds-LA.shp"))

# filter the ejscreen data to Los Angeles County
la_county <- ejscreen %>% 
  filter(STATE_NAME == "California") %>% 
  filter(CNTY_NAME == "Los Angeles County")



holc_grade_colors <- c("#7CAB7DFF", "#75B7D1FF", "#F9D662FF", "#FF7676FF")

```

# Checking that the datasets have the same coordinate reference system 
```{r}

# checking if the crs of la_county and redlining match
if(st_crs(la_county) == st_crs(redlining)){
  print("it's a match!")
} else {
  print("crs does not a match")
}

# setting the crs of redlining to the crs of la_county
redlining <- st_transform(redlining, crs = st_crs(la_county))

# checking again if the crs of the two data sets match, before we proceed
if(st_crs(la_county) == st_crs(redlining)){
  print("it's a match!")
} else {
  print("crs does not a match")
}

```

## Creating Map 1
```{r}

# using la_county and redlining to map the distribution of redline graded neighborhoods
tm_shape(la_county, bbox = redlining) +
  tm_polygons(lwd = 0.5) +
tm_shape(redlining) +
  tm_polygons(fill = "grade",
              palette = holc_grade_colors,
              title = "Grade",
              labels = c("A - Best", "B - Still Desirable", "C - Declining", "D - Hazardous"),
              lwd = 0.5) + 
  tm_title(text = "Redline Grades by Neighborhood in LA County") +
  tm_compass(type = "8star", 
             size = 2) +
  tm_scale_bar(size = 2) +
  tm_components(c("tm_compass", "tm_scalebar"),
                position = c("right", "bottom"))
  
```

# 2. Creating a table summerizing: The percentage of census block groups that fall within each HOLC grade
```{r}

# spatially joining the la_county data to the redlining data and dropping the geometry
la_redline <- st_join(la_county, redlining) %>% 
  st_drop_geometry()

# creating a table
census <- la_redline %>% 
  group_by(grade) %>% 
  summarize(Percentage = (n()/ nrow(la_redline))*100) %>%  
  rename(Grade = grade) %>% 
  gt() %>%
    tab_header(title = md("Percentage of Census Block Groups within Each HOLC Grade"),
               subtitle = md("A - Best, B - Still Desirable, C - Declining, D - Hazardous, NA - Missing Values"))

# displaying the table
census

```
3. Create at least two visualizations summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of the following variables (you may combine variables or create separate plots):
- % low income
- percentile for Particulate Matter 2.5
- percentile for low life expectancy
- Use ggplot for your visualizations! You will first need to calculate mean of each variable grouped by HOLC grade.
```{r}

# calculating the average percent of low income for each HOLC grade
la_county_low_in_mean <- la_redline %>% 
  group_by(grade) %>% 
  summarize(low_in_per = mean(P_LOWINCPCT))

# calculating the average percentile of low life expectancy for each HOLC grade
la_low_life_mean <- la_redline %>% 
  group_by(grade) %>% 
  summarize(low_life_mean = mean(P_LIFEEXPPCT, na.rm = TRUE))

# calculating the average percentile of PM 2.5 for each HOLC grade
la_pm25_mean <- la_redline %>% 
  group_by(grade) %>% 
  summarize(pm25_mean = mean(P_PM25, na.rm = TRUE))
```

```{r}

# visualizing through a bar graph the average percent of low income for each HOLC grade
low_income <- ggplot(data = la_county_low_in_mean, aes(x = grade, y = low_in_per, fill = grade)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = holc_grade_colors,
                    labels = c("A - Best", "B - Still Desirable", "C - Declining", "D - Hazardous")) +
  labs(x = "Grade",
       y = "Average Percent of Low Income",
       title = "Average Percent of Low Income by HOLC Grade",
       fill = "Grade")

# displaying the graph
low_income

```
### Discussion:


```{r}

# visualizing through a bar graph the average percent of average percentile of low life expectancy for each HOLC grade
low_life <- ggplot(data = la_low_life_mean, aes(x = grade, y = low_life_mean, fill = grade)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = holc_grade_colors,
                    labels = c("A - Best", "B - Still Desirable", "C - Declining", "D - Hazardous")) +
  labs(x = "Grade",
       y = "Average Percentile of Low Life Expectancy",
       title = "Average Percentile of Low Life Expectancy by HOLC Grade",
       fill = "Grade")

# displaying the graph
low_life

```
### Discussion:



```{r}

# visualizing through a bar graph the average percent of average percentile of PM 2.5 for each HOLC grade
pm_25 <- ggplot(data = la_pm25_mean, aes(x = grade, y = pm25_mean, fill = grade)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = holc_grade_colors,
                    labels = c("A - Best", "B - Still Desirable", "C - Declining", "D - Hazardous")) +
  labs(x = "Grade",
       y = "Average Percentile of PM 2.5",
       title = "Average Percentile of Low Income by HOLC Grade",
       fill = "Grade")

# displaying the graph
pm_25

```
## Discussion:


# Part 2: Legaacy of redlining in biodiversity observations

```{r}

# checking if the crs of redlining and birds match
if(st_crs(redlining) == st_crs(birds)){
  print("it's a match!")
} else {
  print("crs does not a match")
}

# setting the crs of birds to the crs of redlining
birds <- st_transform(birds, crs = st_crs(redlining))

# checking again if the crs of the two data sets match, before we proceed
if(st_crs(redlining) == st_crs(birds)){
  print("it's a match!")
} else {
  print("crs does not a match")
}

```

```{r}

# spatially joining the birds data to the redlining data, and dropping the geometry as it's not needed
holc_birds <- st_join(redlining, birds) %>% 
  st_drop_geometry()

# calculating the percent of bird observations witin each HOLC grade
birds_percent <- holc_birds %>% 
  group_by(grade) %>% 
  summarise(bird_obs = n() / nrow(holc_birds) * 100)
birds_percent

```


```{r}

# visualizing through a bar graph the percentage of bird observations within each HOLC grade
ggplot(data = birds_percent, aes(x = grade, y = bird_obs, fill = grade)) + 
  geom_bar(stat = "identity") + 
  scale_fill_manual(values = holc_grade_colors,
                    labels = c("A - Best", "B - Still Desirable", "C - Declining", "D - Hazardous")) +
  labs(x = "Grade",
       y = "Percent of Bird Observations",
       title = "Percentage of Bird Observations within Each HOLC Grade")
```


## Discussion:

## 2. 
Our results donâ€™t match the findings from Ellis-Soto et al. 2023! Read the abstract of the study. Why might we have obtained different results in our analysis? What did the paper consider that we did not?


### References:

Global Biodiversity Information Facility, 2021. GBIF. Retrieved: October 8, 2025 from (https://www.gbif.org/)

Nelson, R. K., Winling, L, et al. (2023). Mapping Inequality: Redlining in New Deal America. Digital Scholarship Lab. Retrieved: October, 8, 2025 https://dsl.richmond.edu/panorama/redlining.

U.S. Environmental Protection Agency (EPA), 2023. EJScreen Technical Documentation.

United States Environmental Protection Agency. 2015. EJSCREEN. Retrieved: October, 8, 2025, https://19january2017snapshot.epa.gov/ejscreen/download-ejscreen-data_.html
